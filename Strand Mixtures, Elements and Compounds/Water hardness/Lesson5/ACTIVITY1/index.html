<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Use Around the House</title>
    <style>
        /* Font Imports */
        @font-face {
            font-family: 'Fredoka';
            src: url('../assets/Fredoka-VariableFont_wdth\,wght.ttf') format('truetype');
        }
        ::-webkit-scrollbar {
            display: none;
        }
        /* Root Variables */
        :root {
            --primary-color: #5D04B2;
            --secondary-color: #fbb03b;
            --progress-color: #ffff00;
            --correct-color: #4caf50;
            --text-color-dark: #333;
            --text-color-light: #fff;
            --card-background-light: #ffffff;
            --header-font: 'Fredoka', sans-serif;
            --body-font: var(--header-font);
        }

        /* Proportional Scaling System Setup */
        html {
            font-size: 1.8vmin;
        }

        /* Global Reset & Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f4f8;
            font-family: var(--body-font);
        }

        #game-wrapper {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            max-width: 1200px;
            margin: auto;
            position: relative;
        }

        #game-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            background-color: var(--primary-color);
        }

        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            overflow: hidden;
            padding: 1rem;
        }

        .screen.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }

        /* ===== START SCREEN ===== */
        #start-screen {
            color: var(--text-color-light);
            text-align: center;
            padding: 2rem;
            background-image: url('images/gamebg.jpg');
            background-size: cover;
            background-position: center;
        }
        
        #start-screen h1 {
            color: var(--text-color-light);
            font-size: 4rem;
            text-shadow: 0 0.2rem 0.5rem rgba(0,0,0,0.4);
            font-weight: 500;
        }
        
        .start-button {
            background: var(--secondary-color);
            color: #fff;
            font-weight: 700;
            font-size: 1.1rem;
            border: 3px solid #fff;
            border-radius: 3rem;
            padding: 0.75rem 2.25rem;
            margin-top: 1rem;
            cursor: pointer;
            letter-spacing: 0.02em;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .start-button:hover {
            transform: scale(1.06);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.18);
        }
    
        /* Game Screen Styles */
        #game-screen {
             justify-content: flex-start;
             padding: 0;
             display: flex;
             flex-direction: column;
        }
        
        /* Header / Top Bar */
        .game-top-section { 
            width: 100%;
            background-color: #5D04B2;
            padding: 0.75rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            z-index: 10;
            box-shadow: 0 0.1rem 0.5rem rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        #game-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }
        
        .progress-wrapper {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

         #progress-container {
            width: 12.5rem;
            background-color: rgba(255,255,255,0.3);
            border-radius: 1rem;
            height: 1.25rem;
            border: 2px solid #fff;
            position: relative;
            overflow: hidden;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: #FFFF00;
            border-radius: 0.8rem;
            transition: width 0.5s ease;
        }

        #progress-text {
            color: var(--text-color-light);
            font-weight: 700;
            font-size: 1rem;
            text-shadow: 0.0625rem 0.0625rem 0.125rem rgba(0,0,0,0.6);
            white-space: nowrap;
        }
            
        @keyframes glow-pulse-white {
            0%, 100% { box-shadow: 0 0 1rem rgba(255, 255, 255, 0.7), 0 0 2rem rgba(255, 255, 255, 0.5); transform: scale(1); }
            50% { box-shadow: 0 0 2rem rgba(255, 255, 255, 1), 0 0 3rem rgba(255, 255, 255, 0.7); transform: scale(1.1); }
        }

        .instructions-icon {
            width: 3rem;
            height: 3rem;
            background: rgba(255, 255, 255, 0.2);
            border: 0.15rem solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 15;
            flex-shrink: 0;
            animation: glow-pulse-white 2s infinite ease-in-out;
        }
        .instructions-icon svg { width: 60%; height: 60%; fill: white; }
        .instructions-icon:hover { 
            transform: scale(1.1);
            animation-play-state: paused;
        }
        
        .lab-game-area {
            width: 100%;
            flex-grow: 1;
            position: relative;
            background-image: url('images/hotspot-img.jpg');
            background-size: cover;
            background-position: center;
        }

        @keyframes house-glow {
            0%, 100% { filter: drop-shadow(0 0 1rem var(--secondary-color)); }
            50% { filter: drop-shadow(0 0 2.5rem var(--secondary-color)) drop-shadow(0 0 0.5rem #fff); }
        }

        .glowing-house {
            animation: house-glow 2.5s infinite ease-in-out;
        }
        
        .hotspot {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            width: 8%; 
            height: 15%;
            border-radius: 50%;
            background-color: rgba(255, 255, 0, 0.2);
            border: 0.2rem solid white;
            transform: translate(-50%, -50%);
        }

        @keyframes zone-pulse {
            0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0rem rgba(255, 255, 255, 0.7); }
            70% { box-shadow: 0 0 0 1.5rem rgba(255, 255, 255, 0); }
            100% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0 0rem rgba(255, 255, 255, 0); }
        }
        
        .hotspot.active { 
            animation: zone-pulse 1.5s infinite; 
        }

        .hotspot.completed::before {
            content: 'âœ“';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            color: white;
            font-weight: 700;
            text-shadow: 0 0.1rem 0.3rem rgba(0,0,0,0.5);
        }
        .hotspot.completed { 
            pointer-events: none; 
            background-color: rgba(76, 175, 80, 0.3);
            border-color: rgba(255, 255, 255, 0.5); 
            animation: none;
        }
        
        /* MODALS */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(0.5rem);
            z-index: 100;
            display: flex; justify-content: center; align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .overlay.hidden { display: none; }
        
        .modal {
            background: var(--card-background-light, #fff);
            padding: 2.5rem;
            border-radius: 1rem;
            text-align: center;
            width: 90%; 
            max-width: 50rem;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        
        .modal .modal-title {
            font-size: 2.5rem; font-weight: 600; margin-bottom: 1.5rem;
            color: var(--primary-color);
        }
        .modal p { font-size: 1.5rem; line-height: 1.6; color: var(--text-color-dark, #333); }
        
        #activity-description-overlay .modal p,
        #game-instructions-overlay .modal p {
            text-align: left; background: #f8f9fa; padding: 1.5rem;
            border-radius: 0.75rem; border-left: 0.4rem solid var(--primary-color);
        }

        .modal-close-btn {
            width: 100%; padding: 1.2rem; font-size: 1.5rem; font-weight: 700;
            border: none; border-radius: 0.75rem; cursor: pointer; color: #fff;
            background-color: var(--primary-color);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 1.5rem;
        }
        .modal-close-btn:hover { transform: scale(1.02); }

        /* Scenario Modal (Side-by-side and Responsive) */
        #scenario-overlay .modal {
            display: flex;
            align-items: center;
            gap: 2rem;
            text-align: left;
            max-width: 70rem; /* Allow modal to be wider */
        }

        #scenario-image {
            flex: 0 0 45%;
            width: 2%;
            object-fit: contain;
            border-radius: 0.75rem;
            border: 2px solid #ddd;
            height: 50vh;
        }

        .scenario-content {
            flex: 1 1 auto;
        }

        #choice-container {
            display: flex;
            justify-content: flex-start; /* Align choices to the left */
            gap: 1rem;
            margin-top: 2rem;
        }

        .water-choice-label {
            display: block;
            padding: 1rem 1.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }
        .water-choice-label:hover { background-color: #f0e6ff; }
        
        .water-choice-radio { display: none; }
        .water-choice-radio:checked + .water-choice-label {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Feedback Popup */
        #feedback-overlay .modal {
            max-width: 40rem;
            border-top: 0.5rem solid var(--correct-color);
        }
        #feedback-text {
            text-align: left;
            background-color: #f8f9fa;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.2rem;
            line-height: 1.6;
        }
        #feedback-overlay .modal-title {
            color: var(--correct-color);
        }
        #feedback-overlay .modal-close-btn {
            background-color: var(--correct-color);
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(3rem) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        
        /* Completion Screen */
        #completion-overlay { 
            background-image: url('images/gamebg.jpg');
            background-size: cover;
            color: #fff;
            z-index: 200;
            gap: 1.5rem;
        }
        .completion-header { 
            font-size: clamp(2rem, 7vmin, 4rem);
            text-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.2);
            text-align: center; font-family: var(--header-font);
            position: relative;
            top: 0%;
            font-weight: 600;
        }
   
        .completion-modal-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .completion-image {
            display: block;
            margin: 0 auto 1.5rem auto;
            max-width: 100vw;
            width: 60%;
            height: auto;
            object-fit: contain;
            animation: fadeIn 0.5s ease-out;
            border: 2px solid var(--secondary-color);
            border-radius: 1rem;
        }

        .completion-buttons-footer { 
            position: static;
            width: 100%;
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            padding: 0 2rem 2rem 2rem;
            box-sizing: border-box;
            align-items: flex-end;
            margin-top: 0;
        }
        .completion-btn { 
            font-family: var(--header-font);
            background: #FBB03B;
            color: #fff;
            font-weight: 500;
            font-size: 1.3rem;
            border: 0.3rem solid #fff;
            border-radius: 3rem;
            padding: 0.75rem 2.5rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 0.4rem 0.8rem rgba(0,0,0,0.2);
            text-decoration: none;
            min-width: 14rem;
            text-align: center;
        }
        .completion-btn:hover { transform: scale(1.06); }
        
        /* MEDIA QUERIES */
        @media (max-width: 991px) {
            #game-wrapper { aspect-ratio: unset; width: 100vw; height: 100vh; border-radius: 0; box-shadow: none; }

            html { font-size: 2.8vmin; }
            .completion-header { font-size: 3.5rem; }
             #scenario-image {
                width: 100%;
                max-height: 100vh;
                height: 75vh;
                object-fit: cover;
            }
            .completion-image {
                width: 53%;
            }
        }
        @media (max-width: 768px) {
            html { font-size: 3vmin; }
            .completion-header { font-size: 3rem; }
            .completion-message { font-size: 1.2rem; }

            /* Responsive Scenario Modal */
            #scenario-overlay .modal {
                text-align: center;
            }
            #scenario-image {
                width: 100%;
                max-height: 100vh;
                height: 75vh;
                object-fit: cover;
            }
            #choice-container {
                justify-content: center; /* Center choices on mobile */
            }
        }
    </style>
</head>
<body>
    <div id="game-wrapper">
        <div id="game-container">
            <div id="start-screen" class="screen">
                <h1>Water Use Around the House</h1>
                <button class="start-button" onclick="startGame(); sendEvent(ActivityEvent.START_ACTIVITY, { activityName: 'Water Use Around the House' });">Start Activity</button>
            </div>

            <div id="game-screen" class="screen hidden">
                <div class="game-top-section">
                    <h1 id="game-title">Water Use Around the House</h1>
                    <div class="progress-wrapper">
                         <div id="progress-container"><div id="progress-bar"></div></div>
                        <div id="progress-text">0 / 5</div>
                        <div class="instructions-icon" onclick="showGameInstructions()">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
                        </div>
                    </div>
                </div>
                <div class="lab-game-area" id="lab-game-area"></div>
            </div>

            <div id="completion-overlay" class="screen hidden">
                <h2 class="completion-header">Activity Complete!</h2>
                <div class="completion-modal-content">
                    <img src="images/complete.jpg" alt="Illustration of a house with clean water" class="completion-image" onerror="this.src='https://placehold.co/400x300/5D04B2/ffffff?text=Complete!'; this.onerror=null;">
                </div>
                <div class="completion-buttons-footer">
                    <button class="completion-btn" onclick="restartGame()">Restart Activity</button>
                    <a href="#" class="completion-btn" onclick="sendEvent(ActivityEvent.END_ACTIVITY, { activityName: 'Water Use Around the House' });">Next Activity</a>
                </div>
            </div>

            <div id="activity-description-overlay" class="overlay hidden">
                <div class="modal">
                    <h2 class="modal-title">Activity Introduction</h2>
                    <p>Explore the house and decide where soft water or hard water should be used. Each choice affects health, cleaning, appliances, or plants. Think like a home scientist and plan smart water use!</p>
                    <button class="modal-close-btn" onclick="closeActivityDescription();">Continue</button>
                </div>
            </div>
            
            <div id="game-instructions-overlay" class="overlay hidden">
                <div class="modal">
                    <h2 class="modal-title">Learner Instructions</h2>
                    <p>Click on each highlighted location in the house to decide if hard water or soft water is best there. Select your answer and read the explanation for why that choice is recommended. Visit all areas to complete your water plan.</p>
                    <button class="modal-close-btn" onclick="closeGameInstructions()">Got It!</button>
                </div>
            </div>
            
            <div id="scenario-overlay" class="overlay hidden">
                <div class="modal" id="question-modal">
                    <img id="scenario-image" src="" alt="Scenario location">
                    <div class="scenario-content">
                        <h2 class="modal-title" id="scenario-title">Location Title</h2>
                        <p>Which type of water is best for this use?</p>
                        <div id="choice-container">
                            <input type="radio" id="choice-hard" name="water-type" value="Hard" class="water-choice-radio">
                            <label for="choice-hard" class="water-choice-label"><strong>A.</strong> Hard Water</label>
                            <input type="radio" id="choice-soft" name="water-type" value="Soft" class="water-choice-radio">
                            <label for="choice-soft" class="water-choice-label"><strong>B.</strong> Soft Water</label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="feedback-overlay" class="overlay hidden">
                 <div class="modal">
                    <h2 class="modal-title">Explanation</h2>
                    <p id="feedback-text">This is the explanation text.</p>
                    <button class="modal-close-btn" onclick="closeAllModals()">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <audio id="ding-sound" src="audio/ding.mp3" preload="auto"></audio>
    <audio id="intro-audio" src="audio/intro.mp3" preload="auto"></audio>
    <audio id="outro-audio" src="audio/outro.mp3" preload="auto"></audio>

    <script>
        // --- DATA ---
        const activityData = [
            {
                id: 'kitchen-tap',
                title: 'ðŸ½ï¸ Kitchen Tap',
                image: 'images/tap.jpg',
                explanation: "Hard water contains calcium and magnesium, which are healthy minerals for drinking.",
                coords: { top: '40%', left: '25%', width: '10%', height: '20%' }
            },
            {
                id: 'washing-machine',
                title: 'ðŸ‘š Washing Machine',
                image: 'images/washing-machine.jpg',
                explanation: "Soft water lathers well, reduces detergent use, and prevents mineral deposits on clothes.",
                coords: { top: '40%', left: '43%', width: '10%', height: '20%' }
            },
            {
                id: 'shower',
                title: 'ðŸš¿ Shower',
                image: 'images/shower.jpg',
                explanation: "Soft water is gentle on hair and skin, preventing dryness and avoiding soap scum buildup.",
                coords: { top: '20%', left: '65%', width: '10%', height: '25%' }
            },
            {
                id: 'water-heater',
                title: 'ðŸ”¥ Water Heater',
                image: 'images/water-heater.jpg',
                explanation: "Soft water prevents scale formation inside heating coils, extending appliance life.",
                coords: { top: '65%', left: '90%', width: '10%', height: '20%' }
            },
            {
                id: 'garden-hose',
                title: 'ðŸŒ¿ Garden Hose',
                image: 'images/hose.jpg',
                explanation: "Minerals in hard water can benefit plants and support healthy growth.",
                coords: { top: '85%', left: '70%', width: '12%', height: '20%' }
            }
        ];
        const TOTAL_ACTIVITIES = activityData.length;

        // --- STATE ---
        let completedActivities = new Set();
        let activeActivity = null;

        // --- DOM ELEMENTS ---
        const overlays = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            completion: document.getElementById('completion-overlay'),
            description: document.getElementById('activity-description-overlay'),
            instructions: document.getElementById('game-instructions-overlay'),
            scenario: document.getElementById('scenario-overlay'),
            feedback: document.getElementById('feedback-overlay')
        };
        const labGameArea = document.getElementById('lab-game-area');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const sounds = {
            ding: document.getElementById('ding-sound'),
            intro: document.getElementById('intro-audio'),
            outro: document.getElementById('outro-audio'),
        };
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', initializeGame);

        function initializeGame() {
            labGameArea.innerHTML = ''; 
            activityData.forEach((item, index) => {
                const hotspot = document.createElement('div');
                hotspot.className = 'hotspot';
                hotspot.id = item.id;
                hotspot.dataset.index = index;
                Object.assign(hotspot.style, item.coords);
                labGameArea.appendChild(hotspot);
            });

            document.querySelectorAll('.water-choice-radio').forEach(radio => {
                radio.addEventListener('change', handleChoiceSelection);
            });

            updateHotspotStates();
            updateProgress();
            labGameArea.addEventListener('click', handleHotspotClick);
        }

        // --- GAME FLOW ---
        function startGame() {
            overlays.start.classList.add('hidden');
            overlays.game.classList.remove('hidden');
            setTimeout(() => {
                overlays.description.classList.remove('hidden');
                playSound(sounds.intro);
            }, 500);
        }

        function closeActivityDescription() {
            overlays.description.classList.add('hidden');
            if (sounds.intro) sounds.intro.pause();
        }
        
        function handleHotspotClick(event) {
            const clickedHotspot = event.target.closest('.hotspot');
            if (!clickedHotspot || clickedHotspot.classList.contains('completed')) return;
            
            const activityIndex = parseInt(clickedHotspot.dataset.index);
            activeActivity = activityData[activityIndex];
            showQuestionModal(activeActivity);
        }

        function showQuestionModal(activity) {
            document.getElementById('scenario-title').innerHTML = activity.title;
            const scenarioImage = document.getElementById('scenario-image');
            scenarioImage.src = activity.image;
            scenarioImage.alt = activity.title;
            
            const checkedRadio = document.querySelector('input[name="water-type"]:checked');
            if(checkedRadio) checkedRadio.checked = false;

            overlays.scenario.classList.remove('hidden');
        }

        function handleChoiceSelection() {
            if (!activeActivity) return;
            showFeedbackPopup(activeActivity.explanation);
        }

        function showFeedbackPopup(explanation) {
            document.getElementById('feedback-text').textContent = explanation;
            overlays.feedback.classList.remove('hidden');
        }

        function closeAllModals() {
            overlays.scenario.classList.add('hidden');
            overlays.feedback.classList.add('hidden');
            
            if (activeActivity && !completedActivities.has(activeActivity.id)) {
                playSound(sounds.ding);
                completedActivities.add(activeActivity.id);
                updateProgress();
                updateHotspotStates();
            }
            activeActivity = null;

            if (completedActivities.size === TOTAL_ACTIVITIES) {
                 labGameArea.classList.add('glowing-house');
                 setTimeout(() => {
                     overlays.game.classList.add('hidden');
                     overlays.completion.classList.remove('hidden');
                     playSound(sounds.outro); 
                 }, 1500);
            }
        }
        
        function restartGame() {
            if (sounds.outro) sounds.outro.pause();
            completedActivities.clear();
            activeActivity = null;
            overlays.completion.classList.add('hidden');
            overlays.start.classList.remove('hidden');
            labGameArea.classList.remove('glowing-house');
            updateHotspotStates();
            updateProgress();
        }
        
        // --- UI & FEEDBACK ---
        function updateProgress() {
            const progress = (completedActivities.size / TOTAL_ACTIVITIES) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${completedActivities.size} / ${TOTAL_ACTIVITIES}`;
        }
        
        function updateHotspotStates() {
            document.querySelectorAll('.hotspot').forEach((hotspot) => {
                hotspot.classList.remove('completed', 'active'); 
                if (completedActivities.has(hotspot.id)) {
                    hotspot.classList.add('completed');
                } else {
                    hotspot.classList.add('active');
                }
            });
        }

        function showGameInstructions() { overlays.instructions.classList.remove('hidden'); }
        function closeGameInstructions() { overlays.instructions.classList.add('hidden'); }
        
        // --- UTILITIES ---
        function playSound(audioEl) {
            if (audioEl) {
                audioEl.currentTime = 0;
                audioEl.play().catch(e => console.error('Audio play failed:', e));
            }
        }
    </script>
     <script src="../eventSender.js"></script>
</body>
</html>