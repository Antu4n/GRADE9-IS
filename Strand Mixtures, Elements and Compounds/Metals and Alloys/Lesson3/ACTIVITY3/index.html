<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Properties vs. Uses</title>
<style>
    /* Font Imports */
    @font-face {
        font-family: 'Fredoka';
        /* Assuming assets folder is one level up from where the HTML is. Adjust if needed. */
        src: url('../assets/Fredoka-VariableFont_wdth\,wght.ttf') format('truetype');
    }
    ::-webkit-scrollbar {
        display: none;
    }
    /* Root Variables */
    :root {
        --primary-color: #5D04B2;
        --secondary-color: #fbb03b;
        --progress-color: #ffff00;
        --correct-color: #4caf50;
        --text-color-dark: #333;
        --text-color-light: #fff;
        --card-background-light: #ffffff;
        --header-font: 'Fredoka', sans-serif;
        --body-font: var(--header-font);
        --border-radius: 1rem;
        --shadow-dark: rgba(0, 0, 0, 0.3);
    }
    
    @keyframes glow-pulse {
        0%, 100% {
            box-shadow: 0 0 10px rgba(251, 176, 59, 0.5), 0 0 20px rgba(251, 176, 59, 0.3);
        }
        50% {
            box-shadow: 0 0 20px rgba(251, 176, 59, 0.8), 0 0 30px rgba(251, 176, 59, 0.5);
        }
    }
     @keyframes glow-pulse-white {
      0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.7), 0 0 20px rgba(255,255,255,0.5); transform: scale(1); }
      50% { box-shadow: 0 0 20px rgba(255,255,255,1), 0 0 30px rgba(255,255,255,0.7); transform: scale(1.1); }
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); } }

    /* Global Reset & Base Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100vh; overflow: hidden; }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f4f8;
        font-family: var(--body-font), sans-serif;
        padding: 0.5rem;
    }

    #game-wrapper {
        width: 100%;
        max-width: 1200px;
        aspect-ratio: 16 / 9;
        box-shadow: 0 15px 40px var(--shadow-dark);
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        background: var(--card-background-light);
    }

    #game-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .screen {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        transition: opacity 0.5s ease-in-out;
        overflow: hidden;
    }
    .screen.hidden { opacity: 0; pointer-events: none; }
    
    #start-screen {
       background-image: url('images/gamebg.jpg');
       background-size: cover;
       background-position: center;
       justify-content: center;
       align-items: center;
       padding: 2rem;
       text-align: center;
    }
    #start-screen h1 {
       font-size: clamp(2.5rem, 5vw, 4.2rem);
       color: var(--text-color-light);
       margin-bottom: 1.2rem;
       text-shadow: 0 4px 8px rgba(0,0,0,0.3);
       font-weight: 500;
    }
    .start-button { 
        background: var(--secondary-color); color: var(--text-color-light); font-weight: 900;
        font-size: 1.1rem; border: 3px solid var(--text-color-light); border-radius: 3rem;
        padding: 0.75rem 2.25rem; margin-top: 1rem; cursor: pointer;
        text-shadow: 0 2px 0 #b88b2a; transition: all 0.2s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .start-button:hover { transform: scale(1.06); box-shadow: 0 6px 24px rgba(0,0,0,0.18); }

    #game-screen { background: #f8f9ff; }

    .game-top-section {
        width: 100%; flex-shrink: 0; display: flex; justify-content: space-between;
        align-items: center; background-color: var(--primary-color);
        color: var(--text-color-light); padding: 0.5vw 1.5vw;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2); gap: 1rem; flex-wrap: wrap;
        height: 7vh;
    }
    
    #game-title {
        font-size: clamp(16px, 1.5vw, 24px); font-weight: 800;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3); flex: 1 1 300px; min-width: 0;
    }

    .progress-area { display: flex; align-items: center; gap: 1vw; flex-shrink: 0; }
    #progress-container {
        width: 12vw; background-color: rgba(255,255,255,0.3);
        border-radius: 1rem; height: 1vw;
        border: 2px solid #fff; position: relative; overflow: hidden;
    }
    #progress-bar {
        height: 100%; width: 0%; background: var(--progress-color);
        border-radius: 0.8rem; transition: width 0.5s ease;
    }
    #progress-text {
        color: var(--text-color-light); font-weight: 700; 
        font-size: clamp(14px, 1.2vw, 20px);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
    }
    .instructions-icon {
        width: 2.5vw; height: 2.5vw; background: rgba(255, 255, 255, 0.2); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        transition: all 0.3s ease; flex-shrink: 0;
        animation: glow-pulse-white 2s infinite ease-in-out;
    }
    .instructions-icon:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
    .instructions-icon svg { fill: white; width: 1.2vw; height: 1.2vw; }

    .game-content {
        flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; 
        padding: 1vw; overflow: hidden; position: relative;
    }
    
    #metals-grid-container {
        width: 100%;
        max-width: 95vw;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 1.5vw;
        animation: slideIn 0.5s ease-out;
        padding: 0 1vw;
    }
    .metal-group {
        display: flex;
        flex-direction: column;
        gap: 0.8vw;
    }
    .labeled-row {
        display: grid;
        grid-template-columns: 8vw 1fr;
        align-items: center;
        gap: 1vw;
    }
    .row-label {
        font-family: var(--header-font);
        font-weight: 800;
        color: var(--primary-color);
        text-align: left;
        font-size: clamp(14px, 1.2vw, 20px);
    }
    .metal-names-row, .metal-icons-row {
        display: grid;
        gap: 1vw;
        align-items: center;
    }
    .metal-group.group-4 .metal-names-row,
    .metal-group.group-4 .metal-icons-row {
        grid-template-columns: repeat(4, 1fr);
    }
    .metal-group.group-3 .metal-names-row,
    .metal-group.group-3 .metal-icons-row {
        grid-template-columns: repeat(3, 1fr);
        width: 75%;
        margin: 0 auto;
    }
    .metal-name-cell {
        background: linear-gradient(145deg, var(--primary-color), #7a4ec7); color: white;
        text-transform: uppercase;
        font-size: clamp(12px, 1vw, 18px);
        padding: 0.5vw; border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.07);
        font-weight: bold; text-align: center;
        min-height: 3vw;
        display: flex; align-items: center; justify-content: center;
    }
    .hotspot-container {
        background: #fff; text-align: center;
        padding: 0.5vw; border-radius: 8px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.07);
        display: flex; justify-content: center; align-items: center;
        aspect-ratio: 1 / 1;
    }
    .hotspot {
        width: 100%; height: 100%;
        object-fit: contain; border-radius: 12px; cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 3px solid transparent;
    }
    .hotspot:hover {
        transform: scale(1.1); box-shadow: 0 0 15px var(--secondary-color);
        border-color: var(--secondary-color);
    }
    .hotspot.completed {
        border-color: var(--correct-color);
        cursor: default; pointer-events: none; opacity: 0.7;
    }
    .hotspot-fallback {
        font-size: 2.5vw; cursor: pointer; transition: transform 0.3s;
    }
    .hotspot-fallback:hover { transform: scale(1.2); }
    
    .hint-icon {
        position: absolute; bottom: 1.5rem; right: 1.5rem; width: 50px; height: 50px;
        background: var(--secondary-color); border-radius: 50%; display: flex; align-items: center;
        justify-content: center; cursor: pointer; transition: all 0.3s ease; z-index: 1001;
        box-shadow: 0 4px 15px rgba(251, 176, 59, 0.4); animation: glow-pulse 2s infinite ease-in-out;
        border: 3px solid white;
    }
    .hint-icon:hover { animation-play-state: paused; transform: scale(1.1); }
    .hint-icon svg { fill: white; width: 24px; height: 24px; }

    /* Modal Styles */
    .modal-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.4); backdrop-filter: blur(5px);
        z-index: 3000; display: flex; justify-content: center; align-items: center;
        animation: fadeIn 0.3s ease;
    }
    .modal-overlay.hidden { display: none; }
    .modal-content {
        background: var(--card-background-light); padding: 2rem;
        border-radius: var(--border-radius); text-align: center;
        width: 90%; max-width: 600px;
        animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .modal-content h2 {
      font-size: clamp(1.5rem, 4vw, 2rem); font-weight: 600; margin-bottom: 1.5rem;
      color: var(--primary-color);
    }
    .modal-content p, .modal-content ul { font-size: clamp(1rem, 3vw, 1.2rem); line-height: 1.6; color: var(--text-color-dark); }
    .modal-content ul { list-style-position: inside; text-align: left; padding-left: 1rem; }
    .modal-content li { margin-bottom: 0.8rem; }
    .modal-btn {
        width: 100%; padding: 1rem; font-size: 1.2rem; font-weight: 700;
        border: none; border-radius: 0.75rem; cursor: pointer; color: #fff;
        background-color: var(--primary-color); transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 1.5rem;
    }
    .modal-btn:hover { transform: scale(1.02); }
    #activity-intro-overlay .modal-content, #instructions-overlay .modal-content, #info-modal-overlay .modal-content { border-top: 8px solid var(--primary-color); }
    #activity-intro-overlay .modal-content p { background: #f8f9fa; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid var(--primary-color); }
    #hint-overlay .modal-content { border-top: 8px solid var(--secondary-color); }
    #hint-overlay .modal-content .modal-btn { background-color: var(--secondary-color); }
    .info-table {
        width: 100%; border-collapse: collapse; margin-top: 1rem;
    }
    .info-table th, .info-table td {
        border: 1px solid #ddd; padding: 0.8rem; text-align: left;
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
    }
    .info-table th { background-color: #f2f2f2; font-weight: bold; width: 30%; color: var(--primary-color); }
    
   /* ===== COMPLETION OVERLAY ===== */
    #completion-overlay {
      background-image: url('images/gamebg.jpg'); background-size: cover; background-position: center;
      color: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center;
      gap: 1rem; padding: 1rem;
      width: 100%; height: 100%; position: absolute; top: 0; left: 0;
      transition: opacity 0.5s ease-in-out; overflow: hidden;
    }
    .completion-title-banner {
      font-size: clamp(2rem, 7vmin, 4rem);
      text-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.2);
      text-align: center;
      font-family: var(--header-font);
      font-weight: 500;
    }
    #completion-overlay .modal {
      background: transparent; box-shadow: none; width: auto; max-width: none;
      display: flex; justify-content: center; align-items: center;
      padding: 0; overflow: visible;
    }
    #completion-image {
      width: clamp(400px, 70%, 700px); max-width: 85%; height: auto;
      border: 3px solid var(--secondary-color);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      margin-top: 0.5rem;
    }
    .completion-buttons {
        position: static; width: 100%; display: flex; justify-content: space-between;
        gap: 1rem; padding: 0 2rem 2rem 2rem; box-sizing: border-box;
        align-items: flex-end; margin-top: 0;
    }
    .completion-btn {
       background: #FBB03B; color: #fff; font-weight: 500; font-size: 1.1rem;
       border: 0.1875rem solid #fff; border-radius: 3rem; padding: 0.75rem 2.25rem;
       margin-top: 1rem; cursor: pointer; letter-spacing: 0.02em;
       transition: all 0.2s; box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.2);
       text-wrap: nowrap;
       text-shadow: 0 0.125rem 0 #b88b2a;
    }
    .completion-btn:hover { transform: scale(1.05); box-shadow: 0 0.5rem 1.25rem rgba(0,0,0,0.2); }
    
    
    #takeaways-overlay {
        padding: 0;
        background: none;
        backdrop-filter: none;
    }
    #takeaways-overlay .modal-content {
        background-image: url('images/gamebg.jpg');
        background-size: cover;
        background-position: center;
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        border-radius: 0;
        border: none;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        padding: 2rem;
        overflow: hidden;
    }
    .takeaways-card {
        background: #fdfcff;
        border: 0.0625rem solid #dcd1f0;
        border-radius: 1rem;
        width: 100%;
        max-width: 37.5rem;
        padding: 2rem;
        box-shadow: 0 0.625rem 1.875rem rgba(0,0,0,0.3);
        position: relative;
        z-index: 10;
        max-height: 65vh;
        display: flex;
        flex-direction: column;
    }
    .takeaways-title {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        text-align: center;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    .takeaways-list {
        list-style: none;
        padding: 0;
        margin: 0;
        overflow-y: auto;
        flex-grow: 1;
        padding-right: 1rem;
    }
    .takeaways-list::-webkit-scrollbar { width: 0.5rem; }
    .takeaways-list::-webkit-scrollbar-track { background: #e8dff5; border-radius: 0.25rem;}
    .takeaways-list::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 0.25rem; }
    .takeaways-list li {
        font-size: 1.1rem;
        color: #444;
        line-height: 1.6;
        margin-bottom: 1.2rem;
        display: flex;
        align-items: flex-start;
        text-align: left;
    }
    .takeaways-list li .checkmark {
        color: var(--correct-color);
        margin-right: 0.8rem;
        font-weight: bold;
        font-size: 1.2em;
        margin-top: -0.125rem;
    }
    .end-lesson-btn {
        font-family: 'Fredoka','Nunito',sans-serif;
        background: #FBB03B;
        color: #fff;
        font-weight: 900;
        font-size: 1.2rem;
        border: 0.1875rem solid #fff;
        border-radius: 3rem;
        padding: 0.75rem 2rem;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.2);
        text-shadow: 0 0.125rem 0 #b88b2a;
        margin-top: 1.5rem;
        z-index: 10;
    }
    .end-lesson-btn:hover {
        transform: scale(1.06); 
        box-shadow: 0 0.375rem 1.5rem rgba(0,0,0,0.18);
    }
    /* === END OF TRANSPLANTED STYLES === */

    .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
    
    @media (max-width: 991px) {
    
       #game-wrapper {
            width: 100vw !important; height: 100vh !important;
            min-width: 100vw !important; min-height: 100vh !important;
            border-radius: 0 !important; max-width: none !important;
            aspect-ratio: unset !important; box-shadow: none;
        }
        .game-content { padding-top: 1rem; }
        #metals-grid-container { max-width: 82%; padding: 0 0.5rem; gap: 1rem; }
        #activity-intro-overlay .modal-content, #hint-overlay .modal-content{
            height: 90vh;
            overflow: auto;
        }
        .completion-btn {

            font-size: 0.89rem;

        }
        #completion-image {
            width: 60%;
        }
    }
      @media (max-width: 768px){
        #metals-grid-container {
            max-width: 95%;
        }
      }
</style>
</head>
<body>
<div id="game-wrapper">
   <div id="game-container">
        <div id="start-screen" class="screen">
            <h1>Properties vs. Uses</h1>
            <button class="start-button">Start Activity</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="game-top-section">
               <h1 id="game-title">Interactive Table: Properties vs. Uses</h1>
               <div class="progress-area">
                   <div id="progress-container"><div id="progress-bar"></div></div>
                   <div id="progress-text">0 / 7</div>
               </div>
               <div class="instructions-icon" id="instructions-icon">
                   <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
               </div>
            </div>
            <main class="game-content">
                <div id="metals-grid-container">
                    </div>
            </main>
             <div class="hint-icon" id="hint-button">
                <svg viewBox="0 0 24 24">
                   <path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"></path>
                </svg>
            </div>
        </div>

        <div id="activity-intro-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2>Activity Introduction</h2>
                <p>Every metal has a secret power, some are shiny, some are strong, some resist rust. In this activity, click on different metals or alloys in the table. Discover what makes each special and how that connects to how we use them in daily life.</p>
                <button class="modal-btn" id="intro-continue-btn">Continue</button>
            </div>
        </div>

        <div id="instructions-overlay" class="modal-overlay hidden">
           <div class="modal-content">
               <h2>Learner Instructions</h2>
               <ul>
                   <li>Click on an image in the table for a metal or alloy.</li>
                   <li>Read the property and common use when it appears.</li>
                   <li>Think about why this property makes the material suitable for that use.</li>
               </ul>
               <button class="modal-btn" id="close-instructions-btn">Got it!</button>
           </div>
        </div>

        <div id="hint-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2>Here is a Hint</h2>
                <ul>
                    <li>Think about which materials are used where water or heat are involved.</li>
                    <li>Is the metal meant to conduct electricity, or hold up heavy weight?</li>
                    <li>Does the use require beauty, strength, or both?</li>
                </ul>
                <button class="modal-btn" id="hint-close-btn">Got it!</button>
            </div>
        </div>
       
        <div id="info-modal-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="info-title"></h2>
                <div id="info-content"></div>
                <button class="modal-btn" id="info-continue-btn">Continue</button>
            </div>
        </div>

        <div id="completion-overlay" class="screen hidden">
            <h2 class="completion-title-banner">Activity Wrap Up!</h2>
            <div class="modal">
                <img id="completion-image" src="images/complete.jpg" alt="Completion celebration" onerror="this.src='https://placehold.co/400x300/7c3aed/ffffff?text=Complete!'; this.onerror=null;">
            </div>
            <div class="completion-buttons">
                <button class="completion-btn btn-previous" id="previous-activity-btn">Previous Activity</button>
                <button class="completion-btn btn-restart" id="restart-activity-btn">Restart Activity</button>
                <button class="completion-btn " id="show-takeaways-btn">Key Takeaways</button>
            </div>
        </div>
       
       <div id="takeaways-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 class="completion-title" style="color:var(--text-color-light); text-align:center; margin-bottom:1rem;font-size: 2.2rem;">Lesson Complete!</h2>
                <div class="takeaways-card">
                    <h2 class="takeaways-title"> Key Takeaways</h2>
                    <ul class="takeaways-list">
                        <li>
                            <span class="checkmark">✔</span>
                            <div><strong>Function-Driven Choice:</strong> Metals are chosen for specific uses based on their unique properties like durability, conductivity, appearance, and corrosion resistance.</div>
                        </li>
                        <li>
                            <span class="checkmark">✔</span>
                            <div><strong>Common Metals:</strong> Aluminium is used for pots and planes, Copper for cables, Iron for tools, and Gold/Silver for jewellery.</div>
                        </li>
                        <li>
                           <span class="checkmark">✔</span>
                           <div><strong>Alloy Advantages:</strong> Alloys lie Stainless Steel (cutlery, surgical tools), Brass (instruments, handles), and Bronze (statues, medals) are created to enhance properties like strength and rust resistance.</div>
                       </li>
                        <li>
                            <span class="checkmark">✔</span>
                            <div><strong>Everyday Alloys:</strong> Many common items are made from alloys, including spoons, keys, locks, taps, and bells.</div>
                        </li>
                    </ul>
                </div>
                <button class="end-lesson-btn">End Lesson</button>
            </div>
       </div>
        
        <div id="aria-live-announcer" class="visually-hidden" aria-live="polite"></div>
        
    <audio id="ding-sound" src="audio/ding.mp3" preload="auto"></audio>
    <audio id="buzz-sound" src="audio/buzz.mp3" preload="auto"></audio>
    <audio id="intro-sound" src="audio/intro.mp3" preload="auto"></audio>
    <audio id="outro-sound" src="audio/outro.mp3" preload="auto"></audio>
   </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM Elements ---
    const startScreen = document.getElementById('start-screen'), gameScreen = document.getElementById('game-screen');
    const startBtn = document.querySelector('.start-button');
    const announcer = document.getElementById('aria-live-announcer');
    const progressBar = document.getElementById('progress-bar'), progressText = document.getElementById('progress-text');
    const activityIntroOverlay = document.getElementById('activity-intro-overlay'), introContinueBtn = document.getElementById('intro-continue-btn');
    const instructionsIcon = document.getElementById('instructions-icon'), instructionsOverlay = document.getElementById('instructions-overlay'), closeInstructionsBtn = document.getElementById('close-instructions-btn');
    const infoModalOverlay = document.getElementById('info-modal-overlay'), infoTitle = document.getElementById('info-title'), infoContent = document.getElementById('info-content'), infoContinueBtn = document.getElementById('info-continue-btn');
    const completionOverlay = document.getElementById('completion-overlay'), restartActivityBtn = document.getElementById('restart-activity-btn'), showTakeawaysBtn = document.getElementById('show-takeaways-btn');
    const takeawaysOverlay = document.getElementById('takeaways-overlay');
    const hintButton = document.getElementById('hint-button'), hintOverlay = document.getElementById('hint-overlay'), hintCloseBtn = document.getElementById('hint-close-btn');
    const dingSound = document.getElementById('ding-sound'), introSound = document.getElementById('intro-sound'), outroSound = document.getElementById('outro-sound');

    // --- Game State & Data ---
    const activityData = {
        copper: { name: 'Copper', property: 'High electrical conductivity', use: 'Electrical wiring, motors', image: 'images/copper.png' },
        aluminium: { name: 'Aluminium', property: 'Lightweight and corrosion-resistant', use: 'Cans, aircraft, ladders', image: 'images/aluminium.png' },
        steel: { name: 'Steel', property: 'Strong and durable', use: 'Construction beams, vehicles', image: 'images/steel.png' },
        gold: { name: 'Gold', property: 'Shiny and unreactive', use: 'Jewellery, circuit boards', image: 'images/gold.png' },
        brass: { name: 'Brass', property: 'Attractive, corrosion-resistant alloy', use: 'Musical instruments, decorations', image: 'images/brass.png' },
        bronze: { name: 'Bronze', property: 'Hard and resistant to wear', use: 'Medals, sculptures', image: 'images/bronze.png' },
        stainless_steel: { name: 'Stainless Steel', property: 'Resists rust and staining', use: 'Kitchen sinks, medical tools', image: 'images/stainless-steel.jpg' }
    };
    const TOTAL_PROGRESS_STEPS = Object.keys(activityData).length;
    let revealedMetals = new Set();
    let isPaused = true;

    // --- Sound ---
    function playSound(sound) { if(sound) { sound.currentTime = 0; sound.play().catch(e => {}); } }
    function stopSound(sound) { if(sound) { sound.pause(); } }

    // --- Activity Setup ---
    function populateGrid() {
        const gridContainer = document.getElementById('metals-grid-container');
        gridContainer.innerHTML = '';
        const metalIds = Object.keys(activityData);

        const groups = [metalIds.slice(0, 4), metalIds.slice(4, 7)];

        groups.forEach(group => {
            if (group.length === 0) return;

            const groupContainer = document.createElement('div');
            groupContainer.className = `metal-group group-${group.length}`;

            // Create Labeled Row for Names
            const labeledNamesRow = document.createElement('div');
            labeledNamesRow.className = 'labeled-row';
            const namesLabel = document.createElement('div');
            namesLabel.className = 'row-label';
            namesLabel.textContent = 'Metals';
            const namesRow = document.createElement('div');
            namesRow.className = 'metal-names-row';
            
            // Create Labeled Row for Icons
            const labeledIconsRow = document.createElement('div');
            labeledIconsRow.className = 'labeled-row';
            const iconsLabel = document.createElement('div');
            iconsLabel.className = 'row-label';
            iconsLabel.textContent = 'Items';
            const iconsRow = document.createElement('div');
            iconsRow.className = 'metal-icons-row';


            group.forEach(metalId => {
                const item = activityData[metalId];
                
                const nameCell = document.createElement('div');
                nameCell.className = 'metal-name-cell';
                nameCell.textContent = item.name;
                namesRow.appendChild(nameCell);

                const iconContainer = document.createElement('div');
                iconContainer.className = 'hotspot-container';
                iconContainer.innerHTML = `
                    <img src="${item.image}" alt="Discover properties of ${item.name}" class="hotspot" data-metal-id="${metalId}"
                         onerror="this.outerHTML='<span class=\\'hotspot-fallback\\' data-metal-id=\\'${metalId}\\'>⚛️</span>'">
                `;
                iconsRow.appendChild(iconContainer);
            });

            labeledNamesRow.appendChild(namesLabel);
            labeledNamesRow.appendChild(namesRow);
            
            labeledIconsRow.appendChild(iconsLabel);
            labeledIconsRow.appendChild(iconsRow);

            groupContainer.appendChild(labeledNamesRow);
            groupContainer.appendChild(labeledIconsRow);
            gridContainer.appendChild(groupContainer);
        });
    }

    function setupActivity() {
        isPaused = false;
        revealedMetals.clear();
        document.querySelectorAll('.hotspot').forEach(spot => {
            spot.classList.remove('completed');
            spot.style.pointerEvents = 'auto';
        });
        updateProgress();
        announcer.textContent = 'Activity has been reset.';
    }
    
    // --- UI, Feedback & State Checks ---
    function updateProgress() {
        const progress = revealedMetals.size;
        progressBar.style.width = `${(progress / TOTAL_PROGRESS_STEPS) * 100}%`;
        progressText.textContent = `${progress} / ${TOTAL_PROGRESS_STEPS}`;
    }

    function showInfoModal(metalId) {
        isPaused = true;
        const data = activityData[metalId];
        
        infoTitle.textContent = data.name;
        infoContent.innerHTML = `
            <table class="info-table">
                <tr><th>Property</th><td>${data.property}</td></tr>
                <tr><th>Common Use</th><td>${data.use}</td></tr>
            </table>`;
        
        infoModalOverlay.classList.remove('hidden');
        playSound(dingSound);

        if (!revealedMetals.has(metalId)) {
            revealedMetals.add(metalId);
            const hotspot = document.querySelector(`.hotspot[data-metal-id="${metalId}"]`);
            if(hotspot) {
                hotspot.classList.add('completed');
                hotspot.style.pointerEvents = 'none';
            }
            updateProgress();
        }
    }

    // --- Main Init ---
    function init() {
        populateGrid();

        startBtn.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            activityIntroOverlay.classList.remove('hidden');
            isPaused = true;
            playSound(introSound);
            setupActivity();
            sendEvent(ActivityEvent.START_ACTIVITY, { activityName: 'Properties vs. Uses' });
        });

        introContinueBtn.addEventListener('click', () => {
            activityIntroOverlay.classList.add('hidden');
            isPaused = false;
            stopSound(introSound);
        });

        instructionsIcon.addEventListener('click', () => {
            instructionsOverlay.classList.remove('hidden');
            isPaused = true;
        });

        closeInstructionsBtn.addEventListener('click', () => {
            instructionsOverlay.classList.add('hidden');
            if (revealedMetals.size < TOTAL_PROGRESS_STEPS) isPaused = false;
        });
        
        infoContinueBtn.addEventListener('click', () => {
            infoModalOverlay.classList.add('hidden');
            if (revealedMetals.size < TOTAL_PROGRESS_STEPS) {
                isPaused = false;
            } else {
                isPaused = true;
                // Add a 2-second delay before showing the completion screen
          
                    gameScreen.classList.add('hidden');
                    completionOverlay.classList.remove('hidden');
                    playSound(outroSound);
              
            }
        });

        hintButton.addEventListener('click', () => {
            hintOverlay.classList.remove('hidden');
            isPaused = true;
        });

        hintCloseBtn.addEventListener('click', () => {
            hintOverlay.classList.add('hidden');
            if (revealedMetals.size < TOTAL_PROGRESS_STEPS) isPaused = false;
        });
        
        document.getElementById('metals-grid-container').addEventListener('click', (e) => {
            const target = e.target;
            if (target.classList.contains('hotspot') || target.classList.contains('hotspot-fallback')) {
                const metalId = target.dataset.metalId;
                if(metalId) showInfoModal(metalId);
            }
        });

        // Adjusted button IDs to match the new HTML structure for completion screen
        document.getElementById('previous-activity-btn').addEventListener('click', () => {
            stopSound(outroSound);
            sendEvent(ActivityEvent.PREVIOUS_ACTIVITY, { activityName: 'Properties vs. Uses' });
            window.location.href = '../ACTIVITY2/index.html';
        });

        restartActivityBtn.addEventListener('click', () => {
            stopSound(outroSound);
            completionOverlay.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            setupActivity();
        });

        showTakeawaysBtn.addEventListener('click', () => {
            completionOverlay.classList.add('hidden');
            takeawaysOverlay.classList.remove('hidden');
            sendEvent(ActivityEvent.END_ACTIVITY, { activityName: 'Properties vs. Uses' });
        });

        takeawaysOverlay.querySelector('.end-lesson-btn').addEventListener('click', () => {
            stopSound(outroSound);
            sendEvent(LessonEvent.END_LESSON, { lessonName: 'Uses of Metals and Alloys in Day-to-Day Life: Lesson 3' });
        });
    }

    init();
});
</script>
<script src ="../eventSender.js"></script>
</body>
</html>